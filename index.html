<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è¾²è—ä¸™ç´šè¡“ç§‘è­˜åˆ¥ç·šä¸Šæ¨¡æ“¬æ¸¬é©—</title>
  <!-- çœç•¥éƒ¨åˆ† CSS èˆ‡ HTMLï¼Œé€™è£¡æ”¾çš„æ˜¯ä¿®æ­£ç‰ˆçµæ§‹ -->
  <!-- å…§å« CLOUD_OK æª¢æŸ¥ã€é›²ç«¯ç‹€æ…‹å¾½ç« ã€CORS fallback -->
</head>
<body>
  <h1>è¾²è—ä¸™ç´šè¡“ç§‘è­˜åˆ¥ç·šä¸Šæ¨¡æ“¬æ¸¬é©—</h1>
  <h2>ğŸ† æˆç¸¾æ’è¡Œæ¦œï¼ˆTOP 10ï¼‰ <span class="badge" id="cloudBadge">é›²ç«¯ï¼šæª¢æŸ¥ä¸­â€¦</span></h2>
  <script>
    const API_BASE = 'https://asia-east1-agri-plant-quiz.cloudfunctions.net/api';
    let CLOUD_OK = false;
    async function cloudSubmitScore(record){
      try{
        if(!CLOUD_OK) return null;
        const res = await fetch(API_BASE + '/submit', {
          method:'POST', mode:'cors',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(record)
        });
        if(!res.ok) throw new Error('submit failed '+res.status);
        return await res.json();
      }catch(e){ console.warn('submit error', e); return null; }
    }
    async function cloudFetchTop10(){
      try{
        if(!CLOUD_OK) return [];
        const res = await fetch(API_BASE + '/top10', {mode:'cors'});
        if(!res.ok) throw new Error('fetch top10 failed '+res.status);
        return await res.json();
      }catch(e){ console.warn('top10 error', e); return []; }
    }
    (async function init(){
      try{
        const ctl=new AbortController(); const t=setTimeout(()=>ctl.abort(),6000);
        const ping=await fetch(API_BASE+'/top10',{mode:'cors',signal:ctl.signal});
        clearTimeout(t);
        if(ping.ok){ CLOUD_OK=true; document.getElementById('cloudBadge').textContent='é›²ç«¯ï¼šé€£ç·šæ­£å¸¸'; }
        else { document.getElementById('cloudBadge').textContent='é›²ç«¯ï¼šæœªé€£ç·šï¼ˆæ”¹ç”¨æœ¬æ©Ÿï¼‰'; }
      }catch(e){
        document.getElementById('cloudBadge').textContent='é›²ç«¯ï¼šæœªé€£ç·šï¼ˆæ”¹ç”¨æœ¬æ©Ÿï¼‰';
      }
    })();
  </script>
</body>
</html>